CC = gcc
CFLAGS = -Wall -Wextra -pthread
LDFLAGS = -lpthread

# –¶–µ–ª–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
.PHONY: all clean help lab1 lab2 lab1_clean lab2_clean

# –û—Å–Ω–æ–≤–Ω–∞—è —Ü–µ–ª—å
all: lab1 lab2

# ------------------------- –õ–ê–ë–û–†–ê–¢–û–†–ù–ê–Ø 1 -------------------------
# –ó–∞–¥–∞—á–∞ —Å –ø–æ—Ç–æ–∫–∞–º–∏ –∏ —Å–µ–º–∞—Ñ–æ—Ä–∞–º–∏ POSIX
LAB1_SRC = lab_semaphore.c
LAB1_TARGET = lab_semaphore

# –°–±–æ—Ä–∫–∞ –ø–µ—Ä–≤–æ–π –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ–π
lab1: $(LAB1_TARGET)

$(LAB1_TARGET): $(LAB1_SRC)
	@echo "üîß –ö–æ–º–ø–∏–ª—è—Ü–∏—è –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ–π —Ä–∞–±–æ—Ç—ã 1 (–ø–æ—Ç–æ–∫–∏)..."
	$(CC) $(CFLAGS) -o $@ $< $(LDFLAGS)
	@echo " –ü—Ä–æ–≥—Ä–∞–º–º–∞ $(LAB1_TARGET) —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–∞!"
	@echo "   –î–ª—è –∑–∞–ø—É—Å–∫–∞: ./$(LAB1_TARGET)"

# –ó–∞–ø—É—Å–∫ –ø–µ—Ä–≤–æ–π –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ–π
run_lab1: $(LAB1_TARGET)
	@echo " –ó–∞–ø—É—Å–∫ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ–π —Ä–∞–±–æ—Ç—ã 1..."
	@echo "========================================"
	./$(LAB1_TARGET)

# ------------------------- –õ–ê–ë–û–†–ê–¢–û–†–ù–ê–Ø 2 -------------------------
# –ó–∞–¥–∞—á–∞ —Å —Ä–∞–∑–¥–µ–ª—è–µ–º–æ–π –ø–∞–º—è—Ç—å—é –∏ —Å–µ–º–∞—Ñ–æ—Ä–∞–º–∏ System V
LAB2_SENDER_SRC = sender.c
LAB2_RECEIVER_SRC = receiver.c
LAB2_SENDER_TARGET = sender
LAB2_RECEIVER_TARGET = receiver

# –°–±–æ—Ä–∫–∞ –≤—Ç–æ—Ä–æ–π –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ–π
lab2: $(LAB2_SENDER_TARGET) $(LAB2_RECEIVER_TARGET)

$(LAB2_SENDER_TARGET): $(LAB2_SENDER_SRC)
	@echo "üîß –ö–æ–º–ø–∏–ª—è—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è (–ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è 2)..."
	$(CC) $(CFLAGS) -o $@ $<

$(LAB2_RECEIVER_TARGET): $(LAB2_RECEIVER_SRC)
	@echo "üîß –ö–æ–º–ø–∏–ª—è—Ü–∏—è –ø–æ–ª—É—á–∞—Ç–µ–ª—è (–ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è 2)..."
	$(CC) $(CFLAGS) -o $@ $<

# –°–±–æ—Ä–∫–∞ —Ç–æ–ª—å–∫–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è
sender: $(LAB2_SENDER_TARGET)

# –°–±–æ—Ä–∫–∞ —Ç–æ–ª—å–∫–æ –ø–æ–ª—É—á–∞—Ç–µ–ª—è
receiver: $(LAB2_RECEIVER_TARGET)

# –ó–∞–ø—É—Å–∫ –≤—Ç–æ—Ä–æ–π –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ–π (–Ω—É–∂–Ω–æ –≤ —Ä–∞–∑–Ω—ã—Ö —Ç–µ—Ä–º–∏–Ω–∞–ª–∞—Ö)
run_lab2_info:
	@echo " –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∑–∞–ø—É—Å–∫—É –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ–π —Ä–∞–±–æ—Ç—ã 2:"
	@echo "========================================"
	@echo "1. –í –ü–ï–†–í–û–ú —Ç–µ—Ä–º–∏–Ω–∞–ª–µ –∑–∞–ø—É—Å—Ç–∏—Ç–µ:"
	@echo "   make run_sender"
	@echo ""
	@echo "2. –í–æ –í–¢–û–†–û–ú —Ç–µ—Ä–º–∏–Ω–∞–ª–µ –∑–∞–ø—É—Å—Ç–∏—Ç–µ:"
	@echo "   make run_receiver"
	@echo ""
	@echo "3. –î–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –Ω–∞–∂–º–∏—Ç–µ Ctrl+C –≤ –æ–±–æ–∏—Ö —Ç–µ—Ä–º–∏–Ω–∞–ª–∞—Ö"
	@echo "   –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ: make clean_ipc"

# –ó–∞–ø—É—Å–∫ —Ç–æ–ª—å–∫–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è
run_sender: $(LAB2_SENDER_TARGET)
	@echo "üöÄ –ó–∞–ø—É—Å–∫ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è..."
	@echo "========================================"
	./$(LAB2_SENDER_TARGET)

# –ó–∞–ø—É—Å–∫ —Ç–æ–ª—å–∫–æ –ø–æ–ª—É—á–∞—Ç–µ–ª—è
run_receiver: $(LAB2_RECEIVER_TARGET)
	@echo "üöÄ –ó–∞–ø—É—Å–∫ –ø–æ–ª—É—á–∞—Ç–µ–ª—è..."
	@echo "========================================"
	./$(LAB2_RECEIVER_TARGET)
